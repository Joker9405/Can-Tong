<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Canâ€‘Tong Â· ä¸­è‹±ç²¤äº’è¯‘ + å‘éŸ³</title>
  <style>
    html,body{margin:0;padding:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif;background:#0b0b0c;color:#e8e8ea}
    .wrap{max-width:960px;margin:40px auto;padding:24px}
    .card{background:#141416;border:1px solid #22232a;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{font-size:22px;margin:0 0 12px}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0}
    select,textarea,button,input{background:#0f1013;color:#e8e8ea;border:1px solid #2a2b31;border-radius:10px;padding:10px 12px}
    textarea{width:100%;min-height:120px;resize:vertical}
    button{cursor:pointer}
    .muted{color:#a7a8ad;font-size:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .out{white-space:pre-wrap;background:#0f1013;border:1px solid #2a2b31;border-radius:10px;padding:12px;min-height:120px}
    .badge{font-size:11px;background:#1b1c22;border:1px solid #2a2b31;border-radius:999px;padding:2px 8px;margin-left:8px}
    .tip{font-size:12px;opacity:.8;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Canâ€‘Tong Â· ä¸­è‹±ç²¤äº’è¯‘ + å‘éŸ³ <span id="where" class="badge"></span></h1>
      <div class="row">
        <label>æºè¯­è¨€
          <select id="src">
            <option value="en">English</option>
            <option value="chs">ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰</option>
            <option value="zhh" selected>ç²¤è¯­ï¼ˆæ­£å­—ï¼‰</option>
          </select>
        </label>
        <label>ç›®æ ‡è¯­è¨€
          <select id="tgt">
            <option value="zhh" selected>ç²¤è¯­ï¼ˆæ­£å­—ï¼‰</option>
            <option value="chs">ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰</option>
            <option value="en">English</option>
          </select>
        </label>
        <button id="swap">â‡„ äº’æ¢</button>
      </div>
      <textarea id="inp" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹â€¦ï¼ˆæ”¯æŒ EN / ä¸­æ–‡ / ç²¤è¯­æ­£å­—ï¼‰"></textarea>
      <div class="row">
        <button id="go">ç¿»è¯‘</button>
        <button id="speak">ğŸ”Š ç²¤è¯­å‘éŸ³</button>
      </div>
      <div class="grid">
        <div>
          <div class="muted">ç»“æœ</div>
          <div id="out" class="out"></div>
        </div>
        <div>
          <div class="muted">è°ƒè¯• / å¥åº·æ£€æŸ¥</div>
          <div id="ping" class="out">æ£€æŸ¥ä¸­â€¦</div>
          <div class="tip">å¦‚æœæ­¤å¤„æ˜¾ç¤ºé”™è¯¯ï¼Œè¯·ç¡®è®¤ <code>/api/ping</code> åœ¨ Vercel å¯è®¿é—®ã€‚</div>
        </div>
      </div>
      <p class="muted">è¯´æ˜ï¼šè‹¥æ²¡æœ‰åç«¯ TTSï¼Œå°†å›é€€æµè§ˆå™¨ zhâ€‘HK è¯­éŸ³ã€‚</p>
    </div>
  </div>
  <script>
    // è‡ªåŠ¨åˆ¤æ–­ï¼šå¦‚æœæ˜¯ github.io åŸŸåï¼Œå°±èµ° Vercel çš„å®Œæ•´åŸŸåï¼›å¦åˆ™ï¼ˆåœ¨ Vercel ä¸Šï¼‰ç”¨ç›¸å¯¹è·¯å¾„
    const API_BASE = location.hostname.includes("github.io") ? "https://can-tong.vercel.app" : "";
    document.getElementById("where").textContent = API_BASE ? "å‰ç«¯: GitHub Pages Â· åç«¯: Vercel" : "å‰åç«¯: Vercel";
    const $ = (s)=>document.querySelector(s);
    const src = $("#src"), tgt=$("#tgt"), inp=$("#inp"), out=$("#out"), pingBox=$("#ping");
    $("#swap").onclick=()=>{ const a=src.value; src.value=tgt.value; tgt.value=a; };
    async function ping(){
      try{
        const r = await fetch(API_BASE + "/api/ping");
        const j = await r.json();
        pingBox.textContent = JSON.stringify(j, null, 2);
      }catch(e){
        pingBox.textContent = "Ping å¤±è´¥ï¼š" + e.message;
      }
    }
    async function translate(){
      out.textContent = "ç¿»è¯‘ä¸­â€¦";
      try{
        const r = await fetch(API_BASE + "/api/translate",{
          method:"POST",
          headers:{"content-type":"application/json"},
          body: JSON.stringify({ text: inp.value, src: src.value, tgt: tgt.value })
        });
        const j = await r.json();
        out.textContent = j.text || JSON.stringify(j);
      }catch(e){
        out.textContent = "å‡ºé”™ï¼š" + e.message;
      }
    }
    async function speak(){
      const text = (out.textContent || inp.value || "").trim();
      if(!text){ alert("æ²¡æœ‰å¯è¯»çš„æ–‡æœ¬"); return; }
      try{
        const r = await fetch(API_BASE + "/api/tts?text="+encodeURIComponent(text));
        if(r.ok && r.headers.get("content-type")?.includes("audio")){
          const blob = await r.blob();
          const url = URL.createObjectURL(blob);
          const audio = new Audio(url);
          audio.play();
          return;
        }
      }catch(e){ /* fallthrough */ }
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "zh-HK";
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }
    $("#go").onclick = translate;
    $("#speak").onclick = speak;
    ping();
  </script>
</body>
</html>
